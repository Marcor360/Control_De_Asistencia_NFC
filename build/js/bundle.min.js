document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".asistencia__nfc");e&&e.addEventListener("click",(async function(){const e=document.querySelector(".asistencia__estado");if(e.textContent="Leyendo tarjeta...",e.classList.remove("asistencia__exito","asistencia__error"),e.classList.add("asistencia__leyendo"),"NDEFReader"in window)try{const t=new NDEFReader,a=new AbortController;await t.scan({signal:a.signal}),t.onreading=t=>{a.abort();const n=t.serialNumber;e.textContent="Tarjeta leída: "+n,e.classList.remove("asistencia__leyendo","asistencia__error"),e.classList.add("asistencia__exito");const s=document.querySelector('input[name="codigo_nfc"]');s&&(s.value=n)}}catch(t){e.textContent="Error al leer la tarjeta",e.classList.remove("asistencia__leyendo"),e.classList.add("asistencia__error"),console.error(t)}else e.textContent="Lectura NFC no soportada",e.classList.remove("asistencia__leyendo"),e.classList.add("asistencia__error")}));const t=document.querySelectorAll(".alumnos__accion--eliminar");t.length>0&&t.forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault(),confirm("¿Estás seguro de eliminar este registro?")&&console.log("Registro eliminado")}))}));const a=document.querySelector(".pagos__accion--registrar");a&&a.addEventListener("click",(function(e){e.preventDefault();document.querySelector(".pagos__formulario").classList.toggle("pagos__formulario--visible")}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("lectorNFC");if(e){const t=document.getElementById("estado"),a=document.getElementById("infoAlumno");e.addEventListener("click",(async function(){const e=document.querySelector('input[name="tipoAcceso"]:checked').value;if(t.textContent="Leyendo tarjeta...",t.className="asistencia__estado asistencia__leyendo",a.innerHTML="","NDEFReader"in window)try{const n=new NDEFReader,s=new AbortController;await n.scan({signal:s.signal}),n.onreading=async n=>{s.abort();const o=n.serialNumber;try{const n=await fetch("asistencia.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`accion=registrarAcceso&codigoNFC=${o}&tipoAcceso=${e}`}),s=await n.json();s.exito?(t.textContent=s.mensaje,t.className="asistencia__estado asistencia__exito",s.alumno&&(a.innerHTML=`\n                                <h3 class="asistencia__alumno-nombre">${s.alumno.nombre} ${s.alumno.apellidos}</h3>\n                                <div class="asistencia__registro">\n                                    <span class="asistencia__hora">${s.hora}</span>\n                                    <span class="asistencia__tipo asistencia__tipo--${s.tipoAcceso.toLowerCase()}">${s.tipoAcceso}</span>\n                                </div>\n                            `),setTimeout((()=>{window.location.reload()}),3e3)):(t.textContent=s.mensaje,t.className="asistencia__estado asistencia__error",s.alumno&&(a.innerHTML=`\n                                <h3 class="asistencia__alumno-nombre">${s.alumno.nombre} ${s.alumno.apellidos}</h3>\n                                <p class="asistencia__error">Acceso denegado</p>\n                            `))}catch(e){t.textContent="Error de comunicación",t.className="asistencia__estado asistencia__error",console.error("Error:",e)}}}catch(e){t.textContent="Lectura NFC no soportada",t.className="asistencia__estado asistencia__error",console.error(e)}else t.textContent="Lectura NFC no soportada",t.className="asistencia__estado asistencia__error"}))}}));